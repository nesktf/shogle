cmake_minimum_required(VERSION 3.10)

set(SHOGLE_DIR "${CMAKE_CURRENT_SOURCE_DIR}")

set(SHOGLE_VER_MAJ 0)
set(SHOGLE_VER_MIN 2)
set(SHOGLE_VER_REV 1)
set(SHOGLE_VERSION "${SHOGLE_VER_MAJ}.${SHOGLE_VER_MIN}.${SHOGLE_VER_REV}")

execute_process(COMMAND git rev-parse --short HEAD
  WORKING_DIRECTORY "${SHOGLE_DIR}"
  OUTPUT_VARIABLE SHOGLE_VER_GIT_TAG
  OUTPUT_STRIP_TRAILING_WHITESPACE
)
execute_process(COMMAND git rev-list --count HEAD
  WORKING_DIRECTORY "${SHOGLE_DIR}"
  OUTPUT_VARIABLE SHOGLE_VER_BUILD
  OUTPUT_STRIP_TRAILING_WHITESPACE
)
execute_process(COMMAND git rev-parse --abbrev-ref HEAD
  WORKING_DIRECTORY "${SHOGLE_DIR}"
  OUTPUT_VARIABLE SHOGLE_VER_GIT_BRANCH
  OUTPUT_STRIP_TRAILING_WHITESPACE
)
set(SHOGLE_BUILD_VERSION
  "${SHOGLE_VERSION}-${SHOGLE_VER_BUILD}-${SHOGLE_VER_GIT_TAG} (${SHOGLE_VER_GIT_BRANCH})")

message(STATUS "ShOGLE: Version ${SHOGLE_BUILD_VERSION}")

add_subdirectory("${SHOGLE_DIR}/src")

if (SHOGLE_BUILD_TESTS)
  add_subdirectory("${SHOGLE_DIR}/tests")
endif()

if (SHOGLE_BUILD_EXAMPLES)
  add_subdirectory("${SHOGLE_DIR}/examples")
endif()
